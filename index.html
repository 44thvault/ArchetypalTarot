<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ARCHETYPAL TAROT â€” Symbolic Mirror</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen:wght@400;700&display=swap');

:root {
  --bg: #000000;
  --bg-card: #0a0a0a;
  --gold: #d4a843;
  --gold-dim: #9a7a3a;
  --gold-glow: rgba(212,168,67,0.35);
  --white: #ffffff;
  --white-soft: #e0e0e0;
  --gray: #999999;
  --gray-dim: #666666;
  --red: #e05050;
  --red-dim: #c43c3c;
  --silver: #ccd4dc;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  background: var(--bg);
  font-family: 'Silkscreen', monospace;
  color: var(--white);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  touch-action: manipulation;
}

/* â•â•â• SUBTLE SCANLINES (lighter for readability) â•â•â• */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 3px,
    rgba(255,255,255,0.015) 3px,
    rgba(255,255,255,0.015) 6px
  );
  pointer-events: none;
  z-index: 9999;
}

/* â•â•â• BACKGROUND â•â•â• */
#bg-pattern {
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse at 30% 20%, rgba(212,168,67,0.04) 0%, transparent 50%),
    radial-gradient(ellipse at 70% 80%, rgba(212,168,67,0.03) 0%, transparent 50%);
  z-index: 0;
}

#bg-pattern::after {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
    radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.15) 0%, transparent 100%),
    radial-gradient(1px 1px at 30% 60%, rgba(255,255,255,0.1) 0%, transparent 100%),
    radial-gradient(1px 1px at 50% 10%, rgba(255,255,255,0.08) 0%, transparent 100%),
    radial-gradient(1px 1px at 70% 80%, rgba(255,255,255,0.12) 0%, transparent 100%),
    radial-gradient(1px 1px at 90% 40%, rgba(255,255,255,0.1) 0%, transparent 100%),
    radial-gradient(1px 1px at 85% 15%, rgba(255,255,255,0.08) 0%, transparent 100%);
  animation: starTwinkle 8s ease-in-out infinite alternate;
}

@keyframes starTwinkle {
  0% { opacity: 0.4; }
  50% { opacity: 1; }
  100% { opacity: 0.6; }
}

/* â•â•â• MAIN CONTAINER â•â•â• */
#app {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1;
}

/* â•â•â• SCREENS â•â•â• */
.screen {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  padding: 16px;
}
.screen.active { display: flex; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TITLE SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#title-screen {
  gap: 20px;
  text-align: center;
}

.title-ornament {
  color: var(--gold-dim);
  font-size: 12px;
  letter-spacing: 8px;
  opacity: 0;
  animation: fadeSlideUp 1.5s ease forwards 0.2s;
}

.game-title {
  font-family: 'Press Start 2P', monospace;
  font-size: clamp(20px, 5vw, 40px);
  color: var(--gold);
  text-shadow:
    0 0 30px var(--gold-glow),
    0 2px 0 #6a4a1a;
  letter-spacing: 3px;
  line-height: 1.6;
  opacity: 0;
  animation: fadeSlideUp 1.5s ease forwards 0.5s;
}

.title-subtitle {
  font-size: 12px;
  color: var(--gray);
  letter-spacing: 6px;
  text-transform: uppercase;
  opacity: 0;
  animation: fadeSlideUp 1.5s ease forwards 0.8s;
}

.title-sigil {
  width: 80px;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--gold-dim), transparent);
  opacity: 0;
  animation: fadeSlideUp 1.5s ease forwards 1s;
}

.title-desc {
  font-size: 13px;
  color: var(--gray);
  line-height: 2.2;
  max-width: 480px;
  padding: 0 20px;
  opacity: 0;
  animation: fadeSlideUp 1.5s ease forwards 1.2s;
}

.start-btn {
  font-family: 'Press Start 2P', monospace;
  font-size: 14px;
  color: var(--gold);
  background: none;
  border: 2px solid var(--gold-dim);
  padding: 16px 44px;
  cursor: pointer;
  letter-spacing: 3px;
  position: relative;
  opacity: 0;
  animation: fadeSlideUp 1.5s ease forwards 1.6s;
  transition: all 0.3s;
}
.start-btn:hover, .start-btn:active {
  background: rgba(212,168,67,0.1);
  border-color: var(--gold);
  text-shadow: 0 0 12px var(--gold-glow);
}
.start-btn::before {
  content: 'â–¶';
  position: absolute;
  left: 16px;
  animation: blink 1.2s step-end infinite;
}

@keyframes blink { 50% { opacity: 0; } }
@keyframes fadeSlideUp {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPREAD SCREEN â€” MOBILE FIRST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#spread-screen {
  gap: 12px;
  padding: 12px;
}

.spread-header {
  text-align: center;
  opacity: 0;
  animation: fadeSlideUp 0.8s ease forwards;
}
.spread-header h2 {
  font-family: 'Press Start 2P', monospace;
  font-size: clamp(10px, 2.5vw, 14px);
  color: var(--gold);
  letter-spacing: 2px;
  margin-bottom: 6px;
}
.spread-header p {
  font-size: 11px;
  color: var(--gray);
  letter-spacing: 2px;
}

.spread-labels {
  display: flex;
  gap: clamp(8px, 3vw, 40px);
}
.spread-label {
  text-align: center;
  font-size: 10px;
  color: var(--gray);
  letter-spacing: 1px;
  width: clamp(90px, 28vw, 160px);
  opacity: 0;
  animation: fadeSlideUp 0.6s ease forwards;
  line-height: 1.6;
}
.spread-label:nth-child(1) { animation-delay: 0.3s; }
.spread-label:nth-child(2) { animation-delay: 0.5s; }
.spread-label:nth-child(3) { animation-delay: 0.7s; }
.spread-label .label-num {
  font-family: 'Press Start 2P', monospace;
  font-size: 11px;
  color: var(--gold-dim);
  display: block;
  margin-bottom: 4px;
}

.card-spread {
  display: flex;
  gap: clamp(8px, 3vw, 40px);
  perspective: 800px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD SYSTEM
   Aspect ratio: 461 x 930 â‰ˆ 1:2.017
   Mobile: cards sized to fit 3 across
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.card-slot {
  /* Width is responsive, height is 2.017x width to match your images */
  width: clamp(90px, 28vw, 160px);
  aspect-ratio: 461 / 930;
  position: relative;
  cursor: pointer;
  opacity: 0;
  animation: cardAppear 0.8s ease forwards;
}
.card-slot:nth-child(1) { animation-delay: 0.4s; }
.card-slot:nth-child(2) { animation-delay: 0.6s; }
.card-slot:nth-child(3) { animation-delay: 0.8s; }

@keyframes cardAppear {
  from { opacity: 0; transform: translateY(20px) scale(0.95); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.card-inner {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  transform-style: preserve-3d;
  transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.card-slot.flipped .card-inner {
  transform: rotateY(180deg);
}

.card-face {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  border-radius: 6px;
  overflow: hidden;
  border: 2px solid var(--gold-dim);
  box-shadow: 0 4px 20px rgba(0,0,0,0.8);
}

/* â•â•â• CARD BACK â€” uses cards/23.png â•â•â• */
.card-back {
  background: #1a0a0a;
}
.card-back-img {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  object-fit: cover;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
}
/* CSS fallback if 23.png fails */
.card-back-fallback {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: linear-gradient(135deg, #2a0a0a, #1a0a2a);
  display: flex;
  align-items: center;
  justify-content: center;
}
.card-back.has-image .card-back-fallback { display: none; }
.card-back-diamond {
  position: absolute;
  border: 2px solid rgba(212,168,67,0.3);
  transform: rotate(45deg);
}
.card-back-diamond:nth-child(1) { width: 50%; height: 50%; }
.card-back-diamond:nth-child(2) { width: 35%; height: 35%; border-color: rgba(212,168,67,0.2); }
.card-back-diamond:nth-child(3) { width: 20%; height: 20%; border-color: rgba(212,168,67,0.12); }

/* â•â•â• CARD FRONT â•â•â• */
.card-front {
  transform: rotateY(180deg);
  background: var(--bg-card);
}

.card-front-img {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  object-fit: cover;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
  display: block;
}

.card-front-fallback {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.fb-numeral {
  font-family: 'Press Start 2P', monospace;
  font-size: 10px;
  color: var(--gold-dim);
}
.fb-symbol {
  font-size: clamp(32px, 10vw, 56px);
  filter: drop-shadow(0 0 10px var(--gold-glow));
}
.fb-name {
  font-family: 'Press Start 2P', monospace;
  font-size: clamp(6px, 1.8vw, 9px);
  color: var(--gold);
  text-align: center;
  letter-spacing: 1px;
  padding: 0 6px;
}

.card-front.has-image .card-front-fallback { display: none; }

.card-front-label {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  background: linear-gradient(transparent, rgba(0,0,0,0.9));
  padding: 10px 4px 6px;
  text-align: center;
  font-family: 'Press Start 2P', monospace;
  font-size: clamp(5px, 1.4vw, 8px);
  color: var(--gold);
  letter-spacing: 1px;
  display: none;
}
.card-front.has-image .card-front-label { display: block; }

/* â•â•â• CARD HOVER â•â•â• */
.card-slot:not(.flipped):hover {
  transform: translateY(-4px);
  transition: transform 0.2s;
}
.card-slot:not(.flipped):hover .card-face {
  border-color: var(--gold);
  box-shadow: 0 4px 30px rgba(212,168,67,0.2);
}
.card-slot:not(.flipped):active {
  transform: scale(0.97);
}
.card-slot.flipped { cursor: default; }

.spread-instruction {
  font-size: 12px;
  color: var(--gray);
  letter-spacing: 2px;
  opacity: 0;
  animation: fadeSlideUp 0.6s ease forwards 1s;
  margin-top: 4px;
}
.spread-instruction.hidden { display: none; }

/* â•â•â• READ BUTTON â•â•â• */
.read-btn {
  font-family: 'Press Start 2P', monospace;
  font-size: 12px;
  color: var(--gold);
  background: none;
  border: 2px solid var(--gold-dim);
  padding: 14px 36px;
  cursor: pointer;
  letter-spacing: 2px;
  transition: all 0.3s;
  display: none;
}
.read-btn.visible { display: block; animation: fadeSlideUp 0.6s ease forwards; }
.read-btn:hover, .read-btn:active {
  background: rgba(212,168,67,0.1);
  border-color: var(--gold);
  text-shadow: 0 0 10px var(--gold-glow);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   READING SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#reading-screen {
  overflow-y: auto;
  padding: 24px 16px;
  gap: 0;
  justify-content: flex-start;
  scrollbar-width: thin;
  scrollbar-color: var(--gold-dim) transparent;
  -webkit-overflow-scrolling: touch;
}

.reading-container {
  max-width: 640px;
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding-bottom: 40px;
}

/* â•â•â• 16-BIT TEXT BOX â•â•â• */
.text-box {
  border: 2px solid var(--gold-dim);
  background: rgba(0,0,0,0.9);
  padding: 20px;
  position: relative;
  opacity: 0;
  transform: translateY(10px);
  animation: textBoxReveal 0.6s ease forwards;
}

.text-box::before {
  content: '';
  position: absolute;
  inset: 4px;
  border: 1px solid rgba(212,168,67,0.1);
  pointer-events: none;
}

@keyframes textBoxReveal {
  to { opacity: 1; transform: translateY(0); }
}

.text-box.card-reading:nth-child(1) { animation-delay: 0.2s; }
.text-box.card-reading:nth-child(2) { animation-delay: 0.6s; }
.text-box.card-reading:nth-child(3) { animation-delay: 1.0s; }

.tb-position {
  font-size: 11px;
  color: var(--gray);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 10px;
}

.tb-card-name {
  font-family: 'Press Start 2P', monospace;
  font-size: clamp(13px, 3.5vw, 18px);
  color: var(--gold);
  text-shadow: 0 0 15px var(--gold-glow);
  margin-bottom: 6px;
}

.tb-numeral {
  font-size: 12px;
  color: var(--gray);
  margin-bottom: 14px;
}

.tb-light {
  font-size: 13px;
  color: var(--white);
  line-height: 2;
  margin-bottom: 8px;
}

.tb-shadow {
  font-size: 13px;
  color: var(--red);
  line-height: 2;
  margin-bottom: 14px;
}

.tb-reflection {
  font-size: 13px;
  color: var(--gold);
  font-style: italic;
  line-height: 2;
  padding-top: 12px;
  border-top: 1px solid rgba(212,168,67,0.2);
}

.tb-divider {
  width: 40px;
  height: 1px;
  background: var(--gold-dim);
  margin: 6px 0 12px;
}

/* SYNTHESIS */
.synthesis-box {
  border-color: var(--gold);
  animation-delay: 1.6s;
}

.synth-title {
  font-family: 'Press Start 2P', monospace;
  font-size: 13px;
  color: var(--gold);
  letter-spacing: 3px;
  margin-bottom: 16px;
  text-shadow: 0 0 15px var(--gold-glow);
}

.synth-text {
  font-size: 14px;
  color: var(--white);
  line-height: 2.2;
}

.synth-question {
  font-size: 14px;
  color: var(--gold);
  line-height: 2.2;
  margin-top: 14px;
  padding-top: 12px;
  border-top: 1px solid rgba(212,168,67,0.2);
}

/* â•â•â• AGAIN BUTTON â•â•â• */
.again-btn {
  font-family: 'Press Start 2P', monospace;
  font-size: 12px;
  color: var(--gray);
  background: none;
  border: 2px solid rgba(255,255,255,0.15);
  padding: 14px 36px;
  cursor: pointer;
  letter-spacing: 2px;
  transition: all 0.3s;
  margin-top: 8px;
  opacity: 0;
  animation: fadeSlideUp 0.8s ease forwards 2.2s;
  align-self: center;
}
.again-btn:hover, .again-btn:active {
  color: var(--gold);
  border-color: var(--gold-dim);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE OPTIMIZATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 480px) {
  .card-slot {
    width: 28vw;
  }
  .card-spread {
    gap: 10px;
  }
  .spread-labels {
    gap: 10px;
  }
  .spread-label {
    width: 28vw;
    font-size: 9px;
  }
  .text-box {
    padding: 16px 14px;
  }
  .title-desc {
    font-size: 12px;
  }
}

@media (max-height: 700px) {
  #spread-screen { gap: 8px; padding: 8px; }
  .spread-header h2 { font-size: 10px; }
  .spread-header p { font-size: 10px; }
  .spread-labels { margin-bottom: -4px; }
  .title-desc { display: none; }
}

@media (max-height: 600px) {
  .spread-labels { display: none; }
  .card-slot { width: 25vw; }
  .card-spread { gap: 8px; }
}
</style>
</head>
<body>

<div id="bg-pattern"></div>

<div id="app">

  <!-- â•â•â•â•â•â•â•â•â•â•â• TITLE SCREEN â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="title-screen" class="screen active">
    <div class="title-ornament">âœ¦ âœ¦ âœ¦</div>
    <h1 class="game-title">ARCHETYPAL<br>TAROT</h1>
    <div class="title-sigil"></div>
    <div class="title-subtitle">SYMBOLIC MIRROR</div>
    <p class="title-desc">
      Not prophecy. Not fortune.<br>
      A mirror of the archetypes within.<br><br>
      Draw three cards.<br>
      Explore what patterns emerge.
    </p>
    <button class="start-btn" onclick="beginReading()">&nbsp; BEGIN &nbsp;</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• SPREAD SCREEN â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="spread-screen" class="screen">
    <div class="spread-header">
      <h2>THREE-CARD MIRROR</h2>
      <p>ACTIVE Â· SHADOW Â· INTEGRATION</p>
    </div>

    <div class="spread-labels">
      <div class="spread-label">
        <span class="label-num">I</span>
        ACTIVE<br>ARCHETYPE
      </div>
      <div class="spread-label">
        <span class="label-num">II</span>
        SHADOW /<br>CHALLENGE
      </div>
      <div class="spread-label">
        <span class="label-num">III</span>
        EMERGING<br>POTENTIAL
      </div>
    </div>

    <div class="card-spread" id="card-spread">
      <div class="card-slot" onclick="flipCard(0)">
        <div class="card-inner">
          <div class="card-face card-back" id="card-back-0"></div>
          <div class="card-face card-front" id="card-front-0"></div>
        </div>
      </div>
      <div class="card-slot" onclick="flipCard(1)">
        <div class="card-inner">
          <div class="card-face card-back" id="card-back-1"></div>
          <div class="card-face card-front" id="card-front-1"></div>
        </div>
      </div>
      <div class="card-slot" onclick="flipCard(2)">
        <div class="card-inner">
          <div class="card-face card-back" id="card-back-2"></div>
          <div class="card-face card-front" id="card-front-2"></div>
        </div>
      </div>
    </div>

    <p class="spread-instruction" id="spread-instruction">TAP A CARD TO REVEAL</p>
    <button class="read-btn" id="read-btn" onclick="showReading()">READ THE MIRROR</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• READING SCREEN â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="reading-screen" class="screen">
    <div class="reading-container" id="reading-container"></div>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IMAGE PATHS
//   cards/1.png  = Fool (id 0)  ...  cards/22.png = World (id 21)
//   cards/23.png = Card back image
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function cardImagePath(cardId) {
  return 'cards/' + (cardId + 1) + '.png';
}

var CARD_BACK_IMG = 'cards/23.png';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 22 MAJOR ARCANA â€” ARCHETYPAL DEFINITIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var ARCANA = [
  {
    id: 0, numeral: "0", name: "THE FOOL",
    symbol: "ğŸŒ€",
    archetype: "The Innocent Wanderer",
    light16: "Pure beginning. No map.\nThe road opens. You step.",
    shadow16: "Blind trust. Refusal to see\nthe edge beneath your feet.",
    reflections: [
      "What are you afraid to begin?",
      "Where does trust become avoidance?",
      "What would you do if failure were impossible?"
    ]
  },
  {
    id: 1, numeral: "I", name: "THE MAGICIAN",
    symbol: "âœ§",
    archetype: "The Conscious Will",
    light16: "All tools are present.\nWill shapes the world.\nFocus. Create.",
    shadow16: "Clever hands. Empty heart.\nPower without purpose deceives.",
    reflections: [
      "What skill are you not yet using?",
      "Where does cleverness replace honesty?",
      "What would you create if you trusted your ability?"
    ]
  },
  {
    id: 2, numeral: "II", name: "THE HIGH PRIESTESS",
    symbol: "â˜½",
    archetype: "The Unconscious Depth",
    light16: "Silence holds answers.\nBeneath the surface â€” knowing.\nBe still. Listen.",
    shadow16: "Hidden behind the veil.\nKnowing â€” but refusing to speak.",
    reflections: [
      "What do you already know but haven't admitted?",
      "What truth lives beneath your thinking?",
      "Where does silence protect â€” and where does it imprison?"
    ]
  },
  {
    id: 3, numeral: "III", name: "THE EMPRESS",
    symbol: "â€",
    archetype: "The Creative Mother",
    light16: "Life grows where you tend.\nAbundance. Warmth. Creation\nflows through open hands.",
    shadow16: "Giving until empty.\nNurture becomes a cage.\nWho tends the tender?",
    reflections: [
      "What are you nurturing â€” and what nurtures you?",
      "Where does generosity become self-erasure?",
      "What is ready to be born through you?"
    ]
  },
  {
    id: 4, numeral: "IV", name: "THE EMPEROR",
    symbol: "â™”",
    archetype: "The Sovereign Structure",
    light16: "Order serves the living.\nBoundaries protect. Structure\ngives shape to the shapeless.",
    shadow16: "The throne hardens.\nControl replaces care.\nWalls become prisons.",
    reflections: [
      "Where do you need more structure â€” or less?",
      "Is your authority serving others or yourself?",
      "What boundary needs to be set â€” or dissolved?"
    ]
  },
  {
    id: 5, numeral: "V", name: "THE HIEROPHANT",
    symbol: "â›Š",
    archetype: "The Sacred Teacher",
    light16: "Ancient words carry weight.\nThe path was walked before.\nLearn. Then walk your own.",
    shadow16: "Old rules tighten.\nObedience replaces thought.\nWhose truth do you carry?",
    reflections: [
      "What teaching still serves you â€” and what constrains?",
      "Where do you follow without questioning?",
      "What would your own tradition look like?"
    ]
  },
  {
    id: 6, numeral: "VI", name: "THE LOVERS",
    symbol: "â¦",
    archetype: "The Sacred Choice",
    light16: "Two paths. One heart.\nChoose what reflects your truth.\nLove demands honesty.",
    shadow16: "Fear of loss binds.\nThe choice unmade\nbecomes its own prison.",
    reflections: [
      "What choice are you avoiding â€” and why?",
      "Where does connection require you to be more yourself?",
      "What are you really choosing between?"
    ]
  },
  {
    id: 7, numeral: "VII", name: "THE CHARIOT",
    symbol: "âš”",
    archetype: "The Directed Will",
    light16: "Two horses pull as one.\nConflict becomes direction.\nForward. Through. Now.",
    shadow16: "Force without feeling.\nVictory becomes violence.\nWhere are you running?",
    reflections: [
      "What opposing forces within you need integration?",
      "Is your momentum purposeful or escapist?",
      "What would healthy discipline look like right now?"
    ]
  },
  {
    id: 8, numeral: "VIII", name: "STRENGTH",
    symbol: "ğŸ¦",
    archetype: "The Gentle Power",
    light16: "The lion rests in open hands.\nCourage is not force.\nSoftness holds what fury cannot.",
    shadow16: "Smiling while clenching.\nThe beast is caged, not calmed.\nWhat are you suppressing?",
    reflections: [
      "Where do you mistake control for strength?",
      "What instinct needs compassion, not suppression?",
      "What does your gentlest power feel like?"
    ]
  },
  {
    id: 9, numeral: "IX", name: "THE HERMIT",
    symbol: "ğŸ”",
    archetype: "The Inner Sage",
    light16: "Withdraw. Listen inward.\nThe lamp burns for one.\nTruth waits in silence.",
    shadow16: "Isolation wears the mask\nof wisdom. Alone â€” or hiding?",
    reflections: [
      "What truth waits in your silence?",
      "Is your solitude chosen â€” or defensive?",
      "What inner voice have you been ignoring?"
    ]
  },
  {
    id: 10, numeral: "X", name: "WHEEL OF FORTUNE",
    symbol: "â˜¸",
    archetype: "The Eternal Cycle",
    light16: "The wheel turns.\nWhat falls will rise.\nRelease the grip. Flow.",
    shadow16: "Spinning without center.\nHelpless within the turning.\nWhere is your stillness?",
    reflections: [
      "What cycle are you within â€” and where in it?",
      "What are you resisting that is already changing?",
      "Where is the still point within the turning?"
    ]
  },
  {
    id: 11, numeral: "XI", name: "JUSTICE",
    symbol: "âš–",
    archetype: "The Inner Tribunal",
    light16: "The scales do not lie.\nSee clearly â€” without mercy\nor cruelty. Just truth.",
    shadow16: "Judgment sharpens to blade.\nFairness becomes punishment.\nWho are you punishing?",
    reflections: [
      "What needs honest accounting in your life?",
      "Where does fairness tip into harshness?",
      "What truth are you avoiding through self-judgment?"
    ]
  },
  {
    id: 12, numeral: "XII", name: "THE HANGED ONE",
    symbol: "â¥¯",
    archetype: "The Sacred Surrender",
    light16: "Suspended. Inverted.\nThe world shifts when you stop\nfighting gravity.",
    shadow16: "Suffering worn as crown.\nSurrender becomes identity.\nAre you letting go â€” or giving up?",
    reflections: [
      "What would you see differently if you stopped struggling?",
      "Where does sacrifice become martyrdom?",
      "What must you release to gain new vision?"
    ]
  },
  {
    id: 13, numeral: "XIII", name: "DEATH",
    symbol: "â—‰",
    archetype: "The Great Transformer",
    light16: "An ending comes.\nNot punishment â€” passage.\nRelease what is complete.",
    shadow16: "Clinging to the dead.\nThe old form crumbles.\nWhat are you keeping alive\nthat has already gone?",
    reflections: [
      "What is ending â€” and what are you holding past its time?",
      "What new identity waits behind this loss?",
      "What must decompose to feed new growth?"
    ]
  },
  {
    id: 14, numeral: "XIV", name: "TEMPERANCE",
    symbol: "â³",
    archetype: "The Alchemist",
    light16: "Two waters become one.\nThe blend takes time.\nPatience. Integration. Balance.",
    shadow16: "Extremes call louder\nthan the quiet middle.\nWhere have you lost balance?",
    reflections: [
      "What opposites in you are asking to be blended?",
      "Where does impatience sabotage integration?",
      "What would moderation look like â€” without numbness?"
    ]
  },
  {
    id: 15, numeral: "XV", name: "THE DEVIL",
    symbol: "â›“",
    archetype: "The Binding Shadow",
    light16: "The chains are loose.\nYou could leave â€” but don't.\nName the pattern. See it.",
    shadow16: "Comfortable bondage.\nThe familiar cage feels safe.\nWhat are you addicted to?",
    reflections: [
      "What pattern binds you â€” and what does it protect?",
      "Where does comfort become a cage?",
      "What would you lose if you let this go?"
    ]
  },
  {
    id: 16, numeral: "XVI", name: "THE TOWER",
    symbol: "âš¡",
    archetype: "The Sudden Revelation",
    light16: "Lightning strikes the crown.\nFalse structure breaks.\nTruth burns â€” but frees.",
    shadow16: "Clinging to rubble.\nThe fall feels like punishment.\nWhat illusion are you defending?",
    reflections: [
      "What structure in your life is built on false ground?",
      "What would liberation look like â€” even if it hurts?",
      "What truth have you been avoiding?"
    ]
  },
  {
    id: 17, numeral: "XVII", name: "THE STAR",
    symbol: "âœ¦",
    archetype: "The Gentle Renewal",
    light16: "Gentle light returns.\nAfter the fall â€” renewal.\nPour water. Be healed.",
    shadow16: "Hope too fragile to hold.\nDarkness lingers.\nCan you trust the quiet?",
    reflections: [
      "Where is renewal quietly beginning?",
      "What gentle hope are you afraid to trust?",
      "How do you heal â€” and do you let yourself?"
    ]
  },
  {
    id: 18, numeral: "XVIII", name: "THE MOON",
    symbol: "ğŸŒ™",
    archetype: "The Threshold of Illusion",
    light16: "Moonlight distorts.\nWhat you see may not be real.\nTrust the deeper sense.",
    shadow16: "Shadows become monsters.\nFear writes the story.\nWhat are you imagining\nthat isn't there?",
    reflections: [
      "What fear is distorting your perception?",
      "What truth hides behind the illusion?",
      "Where does imagination serve â€” and where does it deceive?"
    ]
  },
  {
    id: 19, numeral: "XIX", name: "THE SUN",
    symbol: "â˜€",
    archetype: "The Radiant Self",
    light16: "Light without hiding.\nThe self shines, unafraid.\nJoy. Warmth. Presence.",
    shadow16: "A smile that hides the ache.\nBrightness that denies the dark.\nIs this joy â€” or performance?",
    reflections: [
      "Where do you feel most yourself?",
      "Is your brightness authentic â€” or performative?",
      "What does genuine joy feel like in your body?"
    ]
  },
  {
    id: 20, numeral: "XX", name: "JUDGEMENT",
    symbol: "ğŸ””",
    archetype: "The Great Awakening",
    light16: "A call sounds.\nRise from what was.\nAll parts of you â€” gather.",
    shadow16: "The call goes unanswered.\nRefusal to rise. Self-judgment\nreplaces self-reckoning.",
    reflections: [
      "What is calling you to rise â€” and what holds you down?",
      "What part of your past needs integration, not rejection?",
      "What would it mean to answer your own call?"
    ]
  },
  {
    id: 21, numeral: "XXI", name: "THE WORLD",
    symbol: "â—¯",
    archetype: "The Completed Cycle",
    light16: "The circle closes.\nWholeness â€” not perfection.\nDance at the center.",
    shadow16: "Arrival becomes prison.\nThe completed story\nfears its own sequel.",
    reflections: [
      "What cycle is completing in your life?",
      "Can you celebrate arrival without clinging to it?",
      "What new beginning hides within this ending?"
    ]
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SYNTHESIS RULES â€” All text reviewed: no doubled words
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var SYNTHESIS_RULES = [
  { pair: [13, 14], theme: "Transformation seeks Integration.", narrative: "What has ended asks to be\nblended â€” not mourned.\nAlchemy follows loss." },
  { pair: [16, 17], theme: "Collapse opens to Renewal.", narrative: "A tower falls. Stars appear.\nDestruction was not the end â€”\nit was the clearing." },
  { pair: [13, 17], theme: "Death feeds Renewal.", narrative: "From the compost of the old,\ngentle light returns.\nLoss becomes the soil of hope." },
  { pair: [15, 6], theme: "Attachment versus Authentic Choice.", narrative: "Chains whisper comfort.\nThe heart demands truth.\nWhat do you choose â€” safety or love?" },
  { pair: [1, 2], theme: "Conscious meets Unconscious.", narrative: "A hand that shapes\nand a depth that knows.\nAction and intuition seek balance." },
  { pair: [4, 3], theme: "Structure meets Flow.", narrative: "A throne and a garden.\nOrder and abundance\nseek a living balance." },
  { pair: [9, 19], theme: "Solitude meets Radiance.", narrative: "A lamp in the cave.\nA sun in the field.\nBoth are light â€” different medicines." },
  { pair: [0, 21], theme: "Beginning meets Completion.", narrative: "A leap and a dance â€”\nthe same circle.\nEvery ending seeds a start." },
  { pair: [7, 12], theme: "Will meets Surrender.", narrative: "Charge forward â€” or let go?\nWarrior and suspended one\nteach opposing truths." },
  { pair: [8, 15], theme: "Gentle Power meets Shadow Bondage.", narrative: "A lion can be calmed.\nChains can be removed.\nBoth require you to look." },
  { pair: [11, 20], theme: "Judgment meets Awakening.", narrative: "Scales measure.\nA trumpet calls.\nAccountability becomes liberation." },
  { pair: [18, 19], theme: "Illusion meets Clarity.", narrative: "Moonlight and sunlight\nover one landscape.\nWhat you feared in darkness\nreveals itself in dawn." },
  { pair: [16, 13], theme: "Destruction meets Transformation.", narrative: "Two forces of ending\nconverge. Something profound\nis being dismantled.\nTrust the process." },
  { pair: [5, 0], theme: "Tradition meets Wanderer.", narrative: "An old path and a pathless field.\nWhat was taught\nand what must be discovered." },
  { pair: [10, 21], theme: "Turning meets Wholeness.", narrative: "Within the spinning â€”\na still center.\nA cycle approaches completion." },
  { pair: [3, 13], theme: "Creation meets Dissolution.", narrative: "Mother and reaper.\nLife that gives\nand life that takes away.\nBoth are necessary." },
  { pair: [6, 9], theme: "Connection meets Solitude.", narrative: "To love truly,\none must first be whole alone.\nWithdrawal serves union." },
  { pair: [15, 16], theme: "Bondage before Breaking.", narrative: "Chains tighten\nbefore lightning strikes.\nLiberation comes\nwhen you can no longer endure." },
  { pair: [2, 18], theme: "Depth meets Illusion.", narrative: "Priestess and moon.\nDeep knowing navigates\nwhat surface seeing cannot." },
  { pair: [1, 15], theme: "Will meets Compulsion.", narrative: "Mastery and addiction\nshare one root: desire.\nOne is conscious. One is not." }
];

var INTENSIFIERS = {
  13: [16, 15, 10],
  16: [13, 15, 20],
  0: [21, 10],
  8: [2, 11],
  19: [17, 0],
  15: [18, 1]
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var drawnCards = [];
var flippedCount = 0;

function shuffleDeck() {
  var deck = [];
  for (var i = 0; i < 22; i++) deck.push(i);
  for (var i = deck.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var tmp = deck[i]; deck[i] = deck[j]; deck[j] = tmp;
  }
  return deck;
}

function populateCardBacks() {
  for (var i = 0; i < 3; i++) {
    var back = document.getElementById('card-back-' + i);
    back.classList.remove('has-image');
    back.innerHTML =
      '<img class="card-back-img" src="' + CARD_BACK_IMG + '"' +
      ' onload="this.parentElement.classList.add(\'has-image\')"' +
      ' onerror="this.style.display=\'none\'">' +
      '<div class="card-back-fallback">' +
        '<div class="card-back-diamond"></div>' +
        '<div class="card-back-diamond"></div>' +
        '<div class="card-back-diamond"></div>' +
      '</div>';
  }
}

function beginReading() {
  var deck = shuffleDeck();
  drawnCards = [deck[0], deck[1], deck[2]];
  flippedCount = 0;

  populateCardBacks();

  for (var i = 0; i < 3; i++) {
    var card = ARCANA[drawnCards[i]];
    var front = document.getElementById('card-front-' + i);
    var imgSrc = cardImagePath(card.id);

    front.classList.remove('has-image');
    front.innerHTML =
      '<img class="card-front-img" src="' + imgSrc + '"' +
      ' onload="this.parentElement.classList.add(\'has-image\')"' +
      ' onerror="this.style.display=\'none\'">' +
      '<div class="card-front-fallback">' +
        '<span class="fb-numeral">' + card.numeral + '</span>' +
        '<span class="fb-symbol">' + card.symbol + '</span>' +
        '<span class="fb-name">' + card.name + '</span>' +
      '</div>' +
      '<div class="card-front-label">' + card.name + '</div>';
  }

  document.querySelectorAll('.card-slot').forEach(function(s) {
    s.classList.remove('flipped');
  });
  document.getElementById('read-btn').classList.remove('visible');
  document.getElementById('spread-instruction').classList.remove('hidden');
  document.getElementById('spread-instruction').textContent = 'TAP A CARD TO REVEAL';

  switchScreen('spread-screen');
}

function flipCard(index) {
  var slot = document.querySelectorAll('.card-slot')[index];
  if (slot.classList.contains('flipped')) return;

  slot.classList.add('flipped');
  flippedCount++;

  if (flippedCount < 3) {
    var remaining = 3 - flippedCount;
    document.getElementById('spread-instruction').textContent =
      remaining === 1 ? 'ONE CARD REMAINS' : remaining + ' CARDS REMAIN';
  } else {
    document.getElementById('spread-instruction').classList.add('hidden');
    setTimeout(function() {
      document.getElementById('read-btn').classList.add('visible');
    }, 400);
  }
}

function switchScreen(id) {
  document.querySelectorAll('.screen').forEach(function(s) {
    s.classList.remove('active');
  });
  document.getElementById(id).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// READING GENERATOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function findSynthesisRule(id1, id2) {
  return SYNTHESIS_RULES.find(function(r) {
    return (r.pair[0] === id1 && r.pair[1] === id2) ||
           (r.pair[0] === id2 && r.pair[1] === id1);
  });
}

function isIntensified(id1, id2) {
  return (INTENSIFIERS[id1] && INTENSIFIERS[id1].indexOf(id2) !== -1) ||
         (INTENSIFIERS[id2] && INTENSIFIERS[id2].indexOf(id1) !== -1);
}

function generateSynthesis(cards) {
  var c = cards.map(function(id) { return ARCANA[id]; });

  var pairNarrative = null;
  var pairTheme = null;

  var pairs = [[0,1],[1,2],[0,2]];
  for (var p = 0; p < pairs.length; p++) {
    var rule = findSynthesisRule(cards[pairs[p][0]], cards[pairs[p][1]]);
    if (rule) {
      pairNarrative = rule.narrative;
      pairTheme = rule.theme;
      break;
    }
  }

  var intensified = false;
  for (var q = 0; q < pairs.length; q++) {
    if (isIntensified(cards[pairs[q][0]], cards[pairs[q][1]])) {
      intensified = true;
      break;
    }
  }

  var synthLines = [];

  if (pairTheme) {
    synthLines.push(pairTheme);
    synthLines.push('');
    synthLines.push(pairNarrative);
  } else {
    // Generic synthesis â€” carefully worded to avoid doubled articles
    synthLines.push(c[0].name + ' moves through you.');
    synthLines.push(c[1].name + ' creates tension.');
    synthLines.push(c[2].name + ' holds the key.');
    synthLines.push('');

    // Strip leading "The " from archetypes to avoid "The the" patterns
    var a0 = c[0].archetype;
    var a1 = c[1].archetype;
    var a2 = c[2].archetype;

    synthLines.push(a0 + ' energy');
    synthLines.push('meets ' + a1.charAt(0).toLowerCase() + a1.slice(1) + '.');
    synthLines.push(a2 + ' emerges.');
  }

  if (intensified) {
    synthLines.push('');
    synthLines.push('âš¡ These forces amplify each other.');
    synthLines.push('This pattern runs deep.');
  }

  var closingQ = c[2].reflections[Math.floor(Math.random() * c[2].reflections.length)];

  return { lines: synthLines.join('\n'), question: closingQ };
}

function showReading() {
  var container = document.getElementById('reading-container');
  container.innerHTML = '';

  var positions = [
    { label: 'I â€” ACTIVE ARCHETYPE' },
    { label: 'II â€” SHADOW / CHALLENGE' },
    { label: 'III â€” EMERGING POTENTIAL' }
  ];

  for (var i = 0; i < 3; i++) {
    var card = ARCANA[drawnCards[i]];
    var pos = positions[i];
    var reflection = card.reflections[Math.floor(Math.random() * card.reflections.length)];

    var box = document.createElement('div');
    box.className = 'text-box card-reading';
    box.style.animationDelay = (0.2 + i * 0.5) + 's';
    box.innerHTML =
      '<div class="tb-position">' + pos.label + '</div>' +
      '<div class="tb-card-name">' + card.name + '</div>' +
      '<div class="tb-numeral">' + card.numeral + ' â€” ' + card.archetype + '</div>' +
      '<div class="tb-divider"></div>' +
      '<div class="tb-light">' + card.light16 + '</div>' +
      '<div class="tb-shadow">Shadow: ' + card.shadow16 + '</div>' +
      '<div class="tb-reflection">' + reflection + '</div>';
    container.appendChild(box);
  }

  var synth = generateSynthesis(drawnCards);
  var synthBox = document.createElement('div');
  synthBox.className = 'text-box synthesis-box';
  synthBox.style.animationDelay = '1.8s';
  synthBox.innerHTML =
    '<div class="synth-title">âœ¦ SYNTHESIS âœ¦</div>' +
    '<div class="synth-text">' + synth.lines.replace(/\n/g, '<br>') + '</div>' +
    '<div class="synth-question">' + synth.question + '</div>';
  container.appendChild(synthBox);

  var btn = document.createElement('button');
  btn.className = 'again-btn';
  btn.textContent = 'â†º  DRAW AGAIN';
  btn.onclick = beginReading;
  container.appendChild(btn);

  switchScreen('reading-screen');
  document.getElementById('reading-screen').scrollTop = 0;
}
</script>
</body>
</html>
