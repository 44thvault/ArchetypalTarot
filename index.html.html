<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ARCHETYPAL TAROT ‚Äî Symbolic Mirror</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen:wght@400;700&display=swap');

:root {
  --bg: #000000;
  --bg-card: #0a0a0a;
  --gold: #d4a843;
  --gold-dim: #9a7a3a;
  --gold-glow: rgba(212,168,67,0.35);
  --white: #ffffff;
  --white-soft: #e0e0e0;
  --gray: #999999;
  --gray-dim: #666666;
  --red: #e05050;
  --silver: #ccd4dc;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  background: var(--bg);
  font-family: 'Silkscreen', monospace;
  color: var(--white);
  -webkit-font-smoothing: antialiased;
  touch-action: manipulation;
}

body::after {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(255,255,255,0.015) 3px, rgba(255,255,255,0.015) 6px);
  pointer-events: none;
  z-index: 9999;
}

#bg-pattern {
  position: fixed; inset: 0;
  background:
    radial-gradient(ellipse at 30% 20%, rgba(212,168,67,0.04) 0%, transparent 50%),
    radial-gradient(ellipse at 70% 80%, rgba(212,168,67,0.03) 0%, transparent 50%);
  z-index: 0;
}
#bg-pattern::after {
  content: ''; position: absolute; inset: 0;
  background-image:
    radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.15) 0%, transparent 100%),
    radial-gradient(1px 1px at 50% 10%, rgba(255,255,255,0.08) 0%, transparent 100%),
    radial-gradient(1px 1px at 70% 80%, rgba(255,255,255,0.12) 0%, transparent 100%),
    radial-gradient(1px 1px at 90% 40%, rgba(255,255,255,0.1) 0%, transparent 100%);
  animation: starTwinkle 8s ease-in-out infinite alternate;
}
@keyframes starTwinkle { 0%{opacity:.4} 50%{opacity:1} 100%{opacity:.6} }

#app {
  position: relative; width: 100%; height: 100%;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  z-index: 1;
}

.screen {
  display: none; flex-direction: column; align-items: center; justify-content: center;
  width: 100%; height: 100%; padding: 16px;
}
.screen.active { display: flex; }

/* ‚ïê‚ïê‚ïê TITLE ‚ïê‚ïê‚ïê */
#title-screen { gap: 20px; text-align: center; }

.title-ornament { color: var(--gold-dim); font-size: 12px; letter-spacing: 8px; opacity:0; animation: fadeUp 1.5s ease forwards .2s; }
.game-title {
  font-family: 'Press Start 2P', monospace; font-size: clamp(20px,5vw,40px);
  color: var(--gold); text-shadow: 0 0 30px var(--gold-glow), 0 2px 0 #6a4a1a;
  letter-spacing: 3px; line-height: 1.6; opacity:0; animation: fadeUp 1.5s ease forwards .5s;
}
.title-subtitle { font-size: 12px; color: var(--gray); letter-spacing: 6px; text-transform: uppercase; opacity:0; animation: fadeUp 1.5s ease forwards .8s; }
.title-sigil { width: 80px; height: 2px; background: linear-gradient(90deg, transparent, var(--gold-dim), transparent); opacity:0; animation: fadeUp 1.5s ease forwards 1s; }
.title-desc { font-size: 13px; color: var(--gray); line-height: 2.2; max-width: 480px; padding: 0 20px; opacity:0; animation: fadeUp 1.5s ease forwards 1.2s; }

.title-buttons { display: flex; flex-direction: column; gap: 14px; align-items: center; opacity:0; animation: fadeUp 1.5s ease forwards 1.4s; }

.start-btn, .gallery-btn {
  font-family: 'Press Start 2P', monospace; font-size: 14px; color: var(--gold);
  background: none; border: 2px solid var(--gold-dim); padding: 16px 44px;
  cursor: pointer; letter-spacing: 3px; transition: all .3s; white-space: nowrap;
}
.gallery-btn { font-size: 11px; color: var(--gray); border-color: rgba(255,255,255,.15); padding: 12px 28px; letter-spacing: 2px; }
.start-btn:hover,.start-btn:active { background: rgba(212,168,67,.1); border-color: var(--gold); text-shadow: 0 0 12px var(--gold-glow); }
.gallery-btn:hover,.gallery-btn:active { color: var(--gold); border-color: var(--gold-dim); }

@keyframes fadeUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
@keyframes blink { 50%{opacity:0} }

/* ‚ïê‚ïê‚ïê SPREAD ‚ïê‚ïê‚ïê */
#spread-screen { gap: 12px; padding: 12px; }

.spread-header { text-align: center; opacity:0; animation: fadeUp .8s ease forwards; }
.spread-header h2 { font-family: 'Press Start 2P', monospace; font-size: clamp(10px,2.5vw,14px); color: var(--gold); letter-spacing: 2px; margin-bottom: 6px; }
.spread-header p { font-size: 11px; color: var(--gray); letter-spacing: 2px; }

.spread-labels { display: flex; gap: clamp(8px,3vw,40px); }
.spread-label { text-align: center; font-size: 10px; color: var(--gray); letter-spacing: 1px; width: clamp(90px,28vw,160px); opacity:0; animation: fadeUp .6s ease forwards; line-height: 1.6; }
.spread-label:nth-child(1){animation-delay:.3s} .spread-label:nth-child(2){animation-delay:.5s} .spread-label:nth-child(3){animation-delay:.7s}
.spread-label .label-num { font-family: 'Press Start 2P', monospace; font-size: 11px; color: var(--gold-dim); display: block; margin-bottom: 4px; }

.card-spread { display: flex; gap: clamp(8px,3vw,40px); perspective: 800px; }

/* ‚ïê‚ïê‚ïê CARDS ‚ïê‚ïê‚ïê */
.card-slot {
  width: clamp(90px,28vw,160px); aspect-ratio: 461/930;
  position: relative; cursor: pointer; opacity:0; animation: cardIn .8s ease forwards;
}
.card-slot:nth-child(1){animation-delay:.4s} .card-slot:nth-child(2){animation-delay:.6s} .card-slot:nth-child(3){animation-delay:.8s}
@keyframes cardIn { from{opacity:0;transform:translateY(20px) scale(.95)} to{opacity:1;transform:translateY(0) scale(1)} }

.card-inner { position:absolute; top:0; left:0; width:100%; height:100%; transform-style:preserve-3d; transition:transform .8s cubic-bezier(.4,0,.2,1); }
.card-slot.flipped .card-inner { transform:rotateY(180deg); }

.card-face { position:absolute; top:0; left:0; width:100%; height:100%; backface-visibility:hidden; -webkit-backface-visibility:hidden; border-radius:6px; overflow:hidden; border:2px solid var(--gold-dim); box-shadow:0 4px 20px rgba(0,0,0,.8); }

.card-back { background:#1a0a0a; }
.card-back-img { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; image-rendering:pixelated; }
.card-back-fallback { position:absolute; top:0; left:0; width:100%; height:100%; background:linear-gradient(135deg,#2a0a0a,#1a0a2a); display:flex; align-items:center; justify-content:center; }
.card-back.has-image .card-back-fallback{display:none}
.card-back-diamond { position:absolute; border:2px solid rgba(212,168,67,.3); transform:rotate(45deg); }
.card-back-diamond:nth-child(1){width:50%;height:50%} .card-back-diamond:nth-child(2){width:35%;height:35%;border-color:rgba(212,168,67,.2)} .card-back-diamond:nth-child(3){width:20%;height:20%;border-color:rgba(212,168,67,.12)}

.card-front { transform:rotateY(180deg); background:var(--bg-card); }
.card-front-img { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; image-rendering:pixelated; display:block; }
.card-front-fallback { position:absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; }
.fb-numeral { font-family:'Press Start 2P',monospace; font-size:10px; color:var(--gold-dim); }
.fb-symbol { font-size:clamp(32px,10vw,56px); filter:drop-shadow(0 0 10px var(--gold-glow)); }
.fb-name { font-family:'Press Start 2P',monospace; font-size:clamp(6px,1.8vw,9px); color:var(--gold); text-align:center; letter-spacing:1px; padding:0 6px; }
.card-front.has-image .card-front-fallback{display:none}
.card-front-label { position:absolute; bottom:0; left:0; right:0; background:linear-gradient(transparent,rgba(0,0,0,.9)); padding:10px 4px 6px; text-align:center; font-family:'Press Start 2P',monospace; font-size:clamp(5px,1.4vw,8px); color:var(--gold); letter-spacing:1px; display:none; }
.card-front.has-image .card-front-label{display:block}

.card-slot:not(.flipped):hover{transform:translateY(-4px);transition:transform .2s}
.card-slot:not(.flipped):hover .card-face{border-color:var(--gold);box-shadow:0 4px 30px rgba(212,168,67,.2)}
.card-slot:not(.flipped):active{transform:scale(.97)}
.card-slot.flipped{cursor:default}

.spread-instruction { font-size:12px; color:var(--gray); letter-spacing:2px; opacity:0; animation:fadeUp .6s ease forwards 1s; margin-top:4px; }
.spread-instruction.hidden{display:none}

.read-btn { font-family:'Press Start 2P',monospace; font-size:12px; color:var(--gold); background:none; border:2px solid var(--gold-dim); padding:14px 36px; cursor:pointer; letter-spacing:2px; transition:all .3s; display:none; }
.read-btn.visible{display:block;animation:fadeUp .6s ease forwards}
.read-btn:hover,.read-btn:active{background:rgba(212,168,67,.1);border-color:var(--gold);text-shadow:0 0 10px var(--gold-glow)}

/* ‚ïê‚ïê‚ïê READING ‚ïê‚ïê‚ïê */
#reading-screen { overflow-y:auto; padding:24px 16px; gap:0; justify-content:flex-start; scrollbar-width:thin; scrollbar-color:var(--gold-dim) transparent; -webkit-overflow-scrolling:touch; }
.reading-container { max-width:640px; width:100%; display:flex; flex-direction:column; gap:20px; padding-bottom:40px; }

.text-box { border:2px solid var(--gold-dim); background:rgba(0,0,0,.9); padding:20px; position:relative; opacity:0; transform:translateY(10px); animation:tbReveal .6s ease forwards; }
.text-box::before { content:''; position:absolute; inset:4px; border:1px solid rgba(212,168,67,.1); pointer-events:none; }
@keyframes tbReveal { to{opacity:1;transform:translateY(0)} }

.text-box.card-reading:nth-child(1){animation-delay:.2s} .text-box.card-reading:nth-child(2){animation-delay:.6s} .text-box.card-reading:nth-child(3){animation-delay:1s}

/* Thumbnail in reading */
.tb-header { display:flex; gap:14px; align-items:flex-start; margin-bottom:12px; }
.tb-thumb { width:52px; height:auto; aspect-ratio:461/930; border-radius:3px; border:1px solid var(--gold-dim); object-fit:cover; image-rendering:pixelated; flex-shrink:0; }
.tb-thumb-fallback { width:52px; aspect-ratio:461/930; border-radius:3px; border:1px solid var(--gold-dim); background:var(--bg-card); display:flex; align-items:center; justify-content:center; font-size:18px; flex-shrink:0; }
.tb-header-text { flex:1; }

.tb-position { font-size:11px; color:var(--gray); letter-spacing:3px; text-transform:uppercase; margin-bottom:6px; }
.tb-card-name { font-family:'Press Start 2P',monospace; font-size:clamp(12px,3vw,16px); color:var(--gold); text-shadow:0 0 15px var(--gold-glow); margin-bottom:4px; }
.tb-numeral { font-size:12px; color:var(--gray); }
.tb-divider { width:40px; height:1px; background:var(--gold-dim); margin:6px 0 12px; }
.tb-light { font-size:13px; color:var(--white); line-height:2; margin-bottom:8px; }
.tb-shadow { font-size:13px; color:var(--red); line-height:2; margin-bottom:14px; }
.tb-reflection { font-size:13px; color:var(--gold); font-style:italic; line-height:2; padding-top:12px; border-top:1px solid rgba(212,168,67,.2); }

.synthesis-box { border-color:var(--gold); animation-delay:1.6s; }
.synth-title { font-family:'Press Start 2P',monospace; font-size:13px; color:var(--gold); letter-spacing:3px; margin-bottom:16px; text-shadow:0 0 15px var(--gold-glow); }
.synth-text { font-size:14px; color:var(--white); line-height:2.2; }
.synth-question { font-size:14px; color:var(--gold); line-height:2.2; margin-top:14px; padding-top:12px; border-top:1px solid rgba(212,168,67,.2); }

.again-btn { font-family:'Press Start 2P',monospace; font-size:12px; color:var(--gray); background:none; border:2px solid rgba(255,255,255,.15); padding:14px 36px; cursor:pointer; letter-spacing:2px; transition:all .3s; margin-top:8px; opacity:0; animation:fadeUp .8s ease forwards 2.2s; align-self:center; }
.again-btn:hover,.again-btn:active{color:var(--gold);border-color:var(--gold-dim)}

/* ‚ïê‚ïê‚ïê GALLERY ‚ïê‚ïê‚ïê */
#gallery-screen { overflow-y:auto; padding:20px 16px; gap:0; justify-content:flex-start; -webkit-overflow-scrolling:touch; }

.gallery-container { max-width:700px; width:100%; }

.gallery-header { text-align:center; margin-bottom:20px; }
.gallery-header h2 { font-family:'Press Start 2P',monospace; font-size:clamp(11px,2.5vw,15px); color:var(--gold); letter-spacing:2px; margin-bottom:10px; }
.gallery-header p { font-size:12px; color:var(--gray); }

.gallery-back-btn { font-family:'Press Start 2P',monospace; font-size:10px; color:var(--gray); background:none; border:1px solid rgba(255,255,255,.15); padding:10px 20px; cursor:pointer; letter-spacing:2px; transition:all .3s; margin-bottom:20px; }
.gallery-back-btn:hover{color:var(--gold);border-color:var(--gold-dim)}

.gallery-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(90px, 1fr)); gap:12px; padding-bottom:30px; }

.gallery-card { cursor:pointer; transition:transform .2s, box-shadow .2s; border-radius:5px; overflow:hidden; border:2px solid rgba(212,168,67,.2); aspect-ratio:461/930; position:relative; background:var(--bg-card); }
.gallery-card:hover,.gallery-card:active { transform:translateY(-3px); border-color:var(--gold); box-shadow:0 4px 20px rgba(212,168,67,.15); }
.gallery-card img { width:100%; height:100%; object-fit:cover; image-rendering:pixelated; display:block; }
.gallery-card-fallback { position:absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px; font-size:8px; color:var(--gold); text-align:center; padding:4px; }
.gallery-card.has-image .gallery-card-fallback{display:none}
.gallery-card-name { position:absolute; bottom:0; left:0; right:0; background:linear-gradient(transparent,rgba(0,0,0,.92)); padding:6px 3px 4px; font-family:'Press Start 2P',monospace; font-size:clamp(4px,1.2vw,6px); color:var(--gold); text-align:center; letter-spacing:.5px; }

/* ‚ïê‚ïê‚ïê CARD DETAIL ‚ïê‚ïê‚ïê */
#detail-screen { overflow-y:auto; padding:20px 16px; gap:0; justify-content:flex-start; -webkit-overflow-scrolling:touch; }
.detail-container { max-width:600px; width:100%; padding-bottom:40px; }

.detail-back-btn { font-family:'Press Start 2P',monospace; font-size:10px; color:var(--gray); background:none; border:1px solid rgba(255,255,255,.15); padding:10px 20px; cursor:pointer; letter-spacing:2px; transition:all .3s; margin-bottom:20px; }
.detail-back-btn:hover{color:var(--gold);border-color:var(--gold-dim)}

.detail-card-img { width:clamp(120px,40vw,200px); aspect-ratio:461/930; border-radius:6px; border:2px solid var(--gold-dim); object-fit:cover; image-rendering:pixelated; display:block; margin:0 auto 20px; box-shadow:0 4px 30px rgba(0,0,0,.8); }
.detail-card-fallback { width:clamp(120px,40vw,200px); aspect-ratio:461/930; border-radius:6px; border:2px solid var(--gold-dim); background:var(--bg-card); display:flex; align-items:center; justify-content:center; margin:0 auto 20px; font-size:48px; }

.detail-name { font-family:'Press Start 2P',monospace; font-size:clamp(14px,4vw,22px); color:var(--gold); text-align:center; text-shadow:0 0 20px var(--gold-glow); margin-bottom:6px; }
.detail-numeral { font-size:13px; color:var(--gray); text-align:center; margin-bottom:6px; }
.detail-archetype { font-size:14px; color:var(--white); text-align:center; margin-bottom:20px; }

.detail-section { border:2px solid var(--gold-dim); background:rgba(0,0,0,.9); padding:18px; margin-bottom:16px; position:relative; }
.detail-section::before { content:''; position:absolute; inset:4px; border:1px solid rgba(212,168,67,.1); pointer-events:none; }
.detail-section-title { font-family:'Press Start 2P',monospace; font-size:10px; color:var(--gold); letter-spacing:2px; margin-bottom:10px; }
.detail-section-text { font-size:13px; color:var(--white); line-height:2; }
.detail-section-text.shadow-text { color:var(--red); }
.detail-section-text.reflect-text { color:var(--gold); font-style:italic; }

/* ‚ïê‚ïê‚ïê MOBILE ‚ïê‚ïê‚ïê */
@media(max-width:480px){
  .card-slot{width:28vw} .card-spread,.spread-labels{gap:10px} .spread-label{width:28vw;font-size:9px}
  .text-box{padding:16px 14px} .gallery-grid{grid-template-columns:repeat(3,1fr);gap:8px}
}
@media(max-height:700px){ #spread-screen{gap:8px;padding:8px} .spread-header h2{font-size:10px} .spread-labels{margin-bottom:-4px} }
@media(max-height:600px){ .spread-labels{display:none} .card-slot{width:25vw} .card-spread{gap:8px} }
</style>
</head>
<body>
<div id="bg-pattern"></div>
<div id="app">

  <!-- TITLE -->
  <div id="title-screen" class="screen active">
    <div class="title-ornament">‚ú¶ ‚ú¶ ‚ú¶</div>
    <h1 class="game-title">ARCHETYPAL<br>TAROT</h1>
    <div class="title-sigil"></div>
    <div class="title-subtitle">SYMBOLIC MIRROR</div>
    <p class="title-desc">
      Draw three cards.<br>
      Explore what patterns emerge.
    </p>
    <div class="title-buttons">
      <button class="start-btn" onclick="beginReading()">BEGIN</button>
      <button class="gallery-btn" onclick="showGallery()">VIEW ALL 22 ARCANA</button>
    </div>
  </div>

  <!-- SPREAD -->
  <div id="spread-screen" class="screen">
    <div class="spread-header">
      <h2>THREE-CARD MIRROR</h2>
      <p>ACTIVE ¬∑ SHADOW ¬∑ INTEGRATION</p>
    </div>
    <div class="spread-labels">
      <div class="spread-label"><span class="label-num">I</span>ACTIVE<br>ARCHETYPE</div>
      <div class="spread-label"><span class="label-num">II</span>SHADOW /<br>CHALLENGE</div>
      <div class="spread-label"><span class="label-num">III</span>EMERGING<br>POTENTIAL</div>
    </div>
    <div class="card-spread" id="card-spread">
      <div class="card-slot" onclick="flipCard(0)"><div class="card-inner"><div class="card-face card-back" id="card-back-0"></div><div class="card-face card-front" id="card-front-0"></div></div></div>
      <div class="card-slot" onclick="flipCard(1)"><div class="card-inner"><div class="card-face card-back" id="card-back-1"></div><div class="card-face card-front" id="card-front-1"></div></div></div>
      <div class="card-slot" onclick="flipCard(2)"><div class="card-inner"><div class="card-face card-back" id="card-back-2"></div><div class="card-face card-front" id="card-front-2"></div></div></div>
    </div>
    <p class="spread-instruction" id="spread-instruction">TAP A CARD TO REVEAL</p>
    <button class="read-btn" id="read-btn" onclick="showReading()">READ THE MIRROR</button>
  </div>

  <!-- READING -->
  <div id="reading-screen" class="screen">
    <div class="reading-container" id="reading-container"></div>
  </div>

  <!-- GALLERY -->
  <div id="gallery-screen" class="screen">
    <div class="gallery-container" id="gallery-container"></div>
  </div>

  <!-- DETAIL -->
  <div id="detail-screen" class="screen">
    <div class="detail-container" id="detail-container"></div>
  </div>

</div>
<script>
function cardImagePath(id){return 'cards/'+(id+1)+'.png'}
var CARD_BACK_IMG='cards/23.png';

var ARCANA=[
{id:0,numeral:"0",name:"THE FOOL",symbol:"üåÄ",archetype:"The Innocent Wanderer",
light16:"Pure beginning. No map, no destination.\nThe road opens beneath your feet.\nYou step ‚Äî not because you know\nwhere it leads, but because\nsomething in you must move.",
shadow16:"Blind trust masking fear.\nRefusal to see the edge\nbeneath your feet.\nNa√Øvet√© worn as armor\nagainst the weight of knowing.",
expanded:"The Fool represents the primordial impulse to begin ‚Äî the moment before experience shapes us. This is the archetype of radical openness, the willingness to step into the unknown without guarantee. In Jungian terms, this is the puer or puella ‚Äî the eternal youth who carries both the gift of wonder and the danger of refusing to grow. The Fool is not foolish ‚Äî they are pre-rational, existing in a state before the categories of wise and unwise have formed. Every great transformation begins with a Fool's step.",
reflections:["What are you afraid to begin?","Where does trust become avoidance?","What would you do if failure were impossible?"]},

{id:1,numeral:"I",name:"THE MAGICIAN",symbol:"‚úß",archetype:"The Conscious Will",
light16:"All tools are present.\nWill shapes the unshaped world.\nFocus your intention.\nWhat was invisible\nbecomes real through your hands.",
shadow16:"Clever hands. Empty heart.\nPower without purpose deceives.\nManipulation disguised\nas mastery ‚Äî the trickster\nwho fools even himself.",
expanded:"The Magician is the archetype of conscious creation ‚Äî the ability to channel intention into manifestation. This figure stands at the threshold between the inner world of thought and the outer world of action. In the Jungian framework, The Magician represents the ego's healthy capacity to direct psychic energy toward meaningful goals. But in shadow, this same power becomes manipulation: skill divorced from integrity, cleverness without conscience. The Magician asks whether your will serves your wholeness or merely your ambition.",
reflections:["What skill are you not yet using?","Where does cleverness replace honesty?","What would you create if you trusted your ability?"]},

{id:2,numeral:"II",name:"THE HIGH PRIESTESS",symbol:"‚òΩ",archetype:"The Unconscious Depth",
light16:"Silence holds answers\nthat thinking cannot reach.\nBeneath the surface ‚Äî knowing.\nBe still. Listen.\nThe veil parts for the patient.",
shadow16:"Hidden behind the veil,\nknowing but refusing to speak.\nSecrets kept from yourself.\nWithdrawal mistaken\nfor wisdom, silence for peace.",
expanded:"The High Priestess guards the threshold to the unconscious ‚Äî the vast reservoir of knowing that exists below conscious thought. She is the archetype of intuition, inner wisdom, and the feminine principle of receptivity. In Jungian psychology, she represents the anima in its purest form: the bridge between the ego and the deeper Self. Her shadow emerges when we use silence as a weapon, when we hoard inner knowledge rather than letting it flow into life, or when we mistake withdrawal for depth.",
reflections:["What do you already know but haven't admitted?","What truth lives beneath your thinking?","Where does silence protect ‚Äî and where does it imprison?"]},

{id:3,numeral:"III",name:"THE EMPRESS",symbol:"‚ùÄ",archetype:"The Creative Mother",
light16:"Life grows where you tend it.\nAbundance. Warmth. Creation\nflows through open hands.\nThe world responds\nto what you nurture with care.",
shadow16:"Giving until empty.\nNurture becomes a cage.\nWho tends the tender?\nSmothering love that fears\nthe beloved's independence.",
expanded:"The Empress embodies the generative force of nature ‚Äî creativity, fertility, abundance, and unconditional nourishment. She represents the archetype of the Great Mother: the principle that life creates more life through attention and care. In psychological terms, The Empress speaks to our capacity for embodied presence ‚Äî being fully in the sensory world, tending to what grows. Her shadow manifests as over-identification with the caretaker role, losing the self in service to others, or using nurturing as a means of control.",
reflections:["What are you nurturing ‚Äî and what nurtures you?","Where does generosity become self-erasure?","What is ready to be born through you?"]},

{id:4,numeral:"IV",name:"THE EMPEROR",symbol:"‚ôî",archetype:"The Sovereign Structure",
light16:"Order serves the living.\nBoundaries protect what matters.\nStructure gives shape\nto the shapeless.\nAuthority rooted in care.",
shadow16:"The throne hardens the heart.\nControl replaces care.\nWalls become prisons.\nRigidity mistaken for strength,\ndominance for leadership.",
expanded:"The Emperor represents the archetypal father: order, structure, authority, and the protective boundary. He is the principle that gives form to chaos ‚Äî the capacity to organize, lead, and establish rules that serve life. In Jungian terms, The Emperor relates to the Senex archetype ‚Äî the wise old king whose authority derives from earned experience. In shadow, this becomes tyranny: control masquerading as protection, rigidity defended as principle. The Emperor asks whether your structures serve growth or merely prevent change.",
reflections:["Where do you need more structure ‚Äî or less?","Is your authority serving others or yourself?","What boundary needs to be set ‚Äî or dissolved?"]},

{id:5,numeral:"V",name:"THE HIEROPHANT",symbol:"‚õä",archetype:"The Sacred Teacher",
light16:"Ancient words carry weight.\nThe path was walked before you.\nLearn from what endures.\nThen walk your own road\nwith tradition as compass, not cage.",
shadow16:"Old rules tighten their grip.\nObedience replaces thought.\nWhose truth do you carry?\nDogma worn as devotion,\nconformity as belonging.",
expanded:"The Hierophant is the archetype of sacred tradition ‚Äî the teacher, the institution, the inherited wisdom that gives meaning across generations. He represents the bridge between individual experience and collective knowledge. In psychological terms, this card speaks to our relationship with authority, belief systems, and the structures we inherit. His shadow appears as dogma: blind obedience to rules that have lost their living meaning, spiritual bypassing that uses tradition to avoid genuine inner work, or the fear of questioning what was given.",
reflections:["What teaching still serves you ‚Äî and what constrains?","Where do you follow without questioning?","What would your own tradition look like?"]},

{id:6,numeral:"VI",name:"THE LOVERS",symbol:"‚ù¶",archetype:"The Sacred Choice",
light16:"Two paths. One heart.\nChoose what reflects your truth.\nLove demands honesty ‚Äî\nnot sacrifice of self,\nbut full presence within union.",
shadow16:"Fear of loss binds the hands.\nThe choice unmade becomes\nits own prison. Codependency\nwears the face of devotion.\nIndecision hardens into fate.",
expanded:"The Lovers is fundamentally about choice ‚Äî specifically, the kind of choice that defines who you are. This is not merely romantic love but the archetype of values alignment: choosing what resonates with your deepest truth, even when it costs you comfort. In Jungian psychology, The Lovers represents the coniunctio ‚Äî the union of opposites that requires full individuation first. You cannot truly merge with another until you know yourself. The shadow here is codependency, indecision, or choosing from fear rather than love.",
reflections:["What choice are you avoiding ‚Äî and why?","Where does connection require you to be more yourself?","What are you really choosing between?"]},

{id:7,numeral:"VII",name:"THE CHARIOT",symbol:"‚öî",archetype:"The Directed Will",
light16:"Two horses pull as one.\nConflict becomes direction.\nForward ‚Äî through ‚Äî now.\nDiscipline channels\nwhat chaos would scatter.",
shadow16:"Force without feeling.\nVictory becomes violence.\nWhere are you running?\nAggression masked\nas determination.",
expanded:"The Chariot represents the triumph of will over opposing forces ‚Äî but not through suppression. This is the archetype of integration through directed movement. The charioteer must hold two opposing energies in tension and channel them toward a single purpose. Psychologically, this speaks to the challenge of harnessing contradictory impulses: desire and duty, confidence and doubt, instinct and reason. The shadow appears when determination becomes bulldozing, when movement becomes escape, or when winning replaces understanding.",
reflections:["What opposing forces within you need integration?","Is your momentum purposeful or escapist?","What would healthy discipline look like right now?"]},

{id:8,numeral:"VIII",name:"STRENGTH",symbol:"ü¶Å",archetype:"The Gentle Power",
light16:"The lion rests in open hands.\nCourage is not force ‚Äî\nit is presence with what frightens.\nSoftness holds\nwhat fury cannot contain.",
shadow16:"Smiling while clenching.\nThe beast is caged, not calmed.\nWhat are you suppressing?\nFalse composure hides\nthe instinct screaming underneath.",
expanded:"Strength is the paradox at the heart of true power: that genuine strength requires softness, patience, and compassion. This archetype shows us that the wildest inner forces ‚Äî rage, desire, grief ‚Äî cannot be conquered through force but only through relationship. In Jungian terms, Strength represents the ego's capacity to encounter the shadow not as an enemy to defeat but as a living energy to befriend. The shadow of Strength is repression disguised as composure: smiling while the inner beast starves in its cage.",
reflections:["Where do you mistake control for strength?","What instinct needs compassion, not suppression?","What does your gentlest power feel like?"]},

{id:9,numeral:"IX",name:"THE HERMIT",symbol:"üèî",archetype:"The Inner Sage",
light16:"Withdraw. Listen inward.\nThe lamp burns for one.\nTruth waits in silence ‚Äî\nnot the silence of absence,\nbut the silence of arrival.",
shadow16:"Isolation wears the mask\nof wisdom. Alone ‚Äî or hiding?\nWithdrawal as avoidance.\nThe mountain becomes\na fortress against connection.",
expanded:"The Hermit represents the archetype of the wise elder who withdraws from the world not to escape it but to find the light that can only be discovered in solitude. This is the necessary descent inward ‚Äî the dark night of the soul that precedes genuine wisdom. In Jungian psychology, The Hermit is the individuated Self that has earned its solitude through engagement with life. The shadow appears when withdrawal becomes permanent avoidance, when solitude calcifies into isolation, or when the fear of connection disguises itself as spiritual independence.",
reflections:["What truth waits in your silence?","Is your solitude chosen ‚Äî or defensive?","What inner voice have you been ignoring?"]},

{id:10,numeral:"X",name:"WHEEL OF FORTUNE",symbol:"‚ò∏",archetype:"The Eternal Cycle",
light16:"The wheel turns endlessly.\nWhat falls will rise again.\nRelease the grip.\nFlow with the rhythm\nbeneath all events.",
shadow16:"Spinning without center.\nHelpless within the turning.\nWhere is your stillness?\nFatalism replacing\nthe courage to act.",
expanded:"The Wheel of Fortune is the archetype of cyclical change ‚Äî the recognition that all conditions are temporary and all positions relative. This is the great equalizer: what rises must fall, and what falls will rise again. Psychologically, the Wheel speaks to our relationship with impermanence. Can you find the still center within the turning? Can you accept change without collapsing into helplessness? The shadow here is fatalism ‚Äî using the inevitability of change as an excuse not to act, or clinging desperately to a position on the wheel that is already turning.",
reflections:["What cycle are you within ‚Äî and where in it?","What are you resisting that is already changing?","Where is the still point within the turning?"]},

{id:11,numeral:"XI",name:"JUSTICE",symbol:"‚öñ",archetype:"The Inner Tribunal",
light16:"The scales do not lie.\nSee clearly ‚Äî without mercy\nor cruelty. Just truth.\nHonest reckoning\nrestores what denial distorts.",
shadow16:"Judgment sharpens to blade.\nFairness becomes punishment.\nWho are you punishing?\nBlack-and-white thinking\nthat cuts away nuance.",
expanded:"Justice is the archetype of accountability ‚Äî not punishment, but honest seeing. This card represents the inner tribunal where we weigh our actions, choices, and their consequences with clear eyes. In psychological terms, Justice asks us to move beyond self-deception into genuine self-assessment. This is not the harsh inner critic but the fair witness: the part of us that can see both the beauty and the damage we have created. The shadow of Justice is harsh judgment ‚Äî self-punishment masquerading as accountability, or rigid either/or thinking that refuses complexity.",
reflections:["What needs honest accounting in your life?","Where does fairness tip into harshness?","What truth are you avoiding through self-judgment?"]},

{id:12,numeral:"XII",name:"THE HANGED ONE",symbol:"‚•Ø",archetype:"The Sacred Surrender",
light16:"Suspended. Inverted.\nThe world shifts when you stop\nfighting gravity.\nSurrender is not defeat ‚Äî\nit is a new angle of seeing.",
shadow16:"Suffering worn as crown.\nSurrender becomes identity.\nAre you letting go ‚Äî\nor giving up? Martyrdom\nthat feeds on its own pain.",
expanded:"The Hanged One represents the archetype of willing suspension ‚Äî the paradox that sometimes the most powerful action is to stop acting. By inverting our usual perspective, we gain access to truths that right-side-up thinking cannot reach. In Jungian terms, this is the ego's surrender to the Self: the moment when control is released and a deeper intelligence is allowed to emerge. The shadow here is martyrdom ‚Äî using suffering as identity, wearing sacrifice as a badge, or confusing stagnation with spiritual depth.",
reflections:["What would you see differently if you stopped struggling?","Where does sacrifice become martyrdom?","What must you release to gain new vision?"]},

{id:13,numeral:"XIII",name:"DEATH",symbol:"‚óâ",archetype:"The Great Transformer",
light16:"An ending comes.\nNot punishment ‚Äî passage.\nRelease what is complete.\nThe old form dissolves\nso new life can take shape.",
shadow16:"Clinging to the dead.\nThe old form crumbles in your hands.\nWhat are you keeping alive\nthat has already gone?\nResistance to the void\nbetween who you were and who you'll become.",
expanded:"Death is the archetype of necessary transformation ‚Äî the great composting of identity. This is not literal death but the psychological experience of an ending so complete that the old self cannot survive it. In Jungian psychology, Death represents the nigredo: the blackening, the dissolution that precedes rebirth. Everything that lives must also die ‚Äî not as punishment but as the fundamental rhythm of renewal. The shadow of Death is clinging: holding onto relationships, identities, habits, and beliefs long past their natural expiration, creating a kind of psychic mummification.",
reflections:["What is ending ‚Äî and what are you holding past its time?","What new identity waits behind this loss?","What must decompose to feed new growth?"]},

{id:14,numeral:"XIV",name:"TEMPERANCE",symbol:"‚è≥",archetype:"The Alchemist",
light16:"Two waters become one.\nThe blend takes time and care.\nPatience. Integration.\nBalance is not stillness ‚Äî\nit is the art of holding both.",
shadow16:"Extremes call louder\nthan the quiet middle.\nWhere have you lost balance?\nImpatience destroying\nwhat only time can complete.",
expanded:"Temperance is the archetype of integration ‚Äî the alchemist who blends opposing substances into something new. This is the patient, skillful work of finding the third way between extremes. In psychological terms, Temperance represents the transcendent function: the capacity to hold two opposing truths simultaneously until a synthesis emerges that contains both. This is not compromise or lukewarm moderation but a creative act of blending that transforms both elements. The shadow appears as impatience, extremism, or the refusal to find middle ground.",
reflections:["What opposites in you are asking to be blended?","Where does impatience sabotage integration?","What would moderation look like ‚Äî without numbness?"]},

{id:15,numeral:"XV",name:"THE DEVIL",symbol:"‚õì",archetype:"The Binding Shadow",
light16:"The chains are loose.\nYou could leave ‚Äî but don't.\nName the pattern. See it.\nAwareness of bondage\nis the first key to freedom.",
shadow16:"Comfortable bondage.\nThe familiar cage feels safe.\nWhat are you addicted to?\nUnconscious compulsion\nwearing the mask of choice.",
expanded:"The Devil is the archetype of shadow attachment ‚Äî the bonds we wear willingly, the patterns we cannot stop repeating, the comfort we find in our own cages. In Jungian terms, The Devil represents the shadow made visible: the parts of ourselves we have disowned but which continue to drive our behavior from the unconscious. The crucial insight of The Devil is that the chains are always loose. We are not trapped by external forces but by our own unwillingness to see clearly. Liberation begins with naming the pattern, even before we can change it.",
reflections:["What pattern binds you ‚Äî and what does it protect?","Where does comfort become a cage?","What would you lose if you let this go?"]},

{id:16,numeral:"XVI",name:"THE TOWER",symbol:"‚ö°",archetype:"The Sudden Revelation",
light16:"Lightning strikes the crown.\nFalse structure breaks apart.\nTruth burns ‚Äî but frees.\nWhat was built on illusion\ncannot withstand reality.",
shadow16:"Clinging to rubble.\nThe fall feels like punishment.\nWhat illusion are you defending?\nResistance to revelation\nthat would set you free.",
expanded:"The Tower is the archetype of sudden, liberating destruction ‚Äî the lightning bolt of truth that shatters structures built on false foundations. This is not random chaos but targeted revelation: the universe's way of demolishing what can no longer stand. Psychologically, Tower moments occur when we have built an identity, relationship, or belief system on self-deception, and reality finally breaks through. These moments are devastating but ultimately liberating. The shadow of The Tower is the desperate attempt to rebuild on the same false ground, clinging to rubble instead of walking forward.",
reflections:["What structure in your life is built on false ground?","What would liberation look like ‚Äî even if it hurts?","What truth have you been avoiding?"]},

{id:17,numeral:"XVII",name:"THE STAR",symbol:"‚ú¶",archetype:"The Gentle Renewal",
light16:"Gentle light returns.\nAfter the fall ‚Äî renewal.\nPour water. Be healed.\nHope is not denial ‚Äî\nit is the first green shoot after fire.",
shadow16:"Hope too fragile to hold.\nDarkness lingers on.\nCan you trust the quiet?\nDespair disguised as realism,\ncynicism as protection.",
expanded:"The Star is the archetype of renewal after crisis ‚Äî the gentle, quiet healing that follows The Tower's destruction. This is not forced optimism but genuine reconnection with deeper purpose. In psychological terms, The Star represents the moment when, after the ego has been shattered, a deeper sense of Self emerges ‚Äî vulnerable, exposed, but authentically connected to something larger. The shadow of The Star is despair disguised as realism: the refusal to trust that healing is possible, or the fragility of hope that collapses at the first sign of difficulty.",
reflections:["Where is renewal quietly beginning?","What gentle hope are you afraid to trust?","How do you heal ‚Äî and do you let yourself?"]},

{id:18,numeral:"XVIII",name:"THE MOON",symbol:"üåô",archetype:"The Threshold of Illusion",
light16:"Moonlight distorts and reveals.\nWhat you see may not be real.\nTrust the deeper sense.\nThe unconscious speaks\nin symbols, not certainties.",
shadow16:"Shadows become monsters.\nFear writes the story.\nWhat are you imagining\nthat isn't there?\nConfusion fed by anxiety\nthat distorts all perception.",
expanded:"The Moon is the archetype of the liminal space ‚Äî the threshold between conscious and unconscious, waking and dreaming, reality and illusion. In this moonlit landscape, nothing is quite what it appears. Psychologically, The Moon represents the journey through the unconscious: a necessary but disorienting passage where our fears, fantasies, and projections become temporarily indistinguishable from reality. The gift of The Moon is creative imagination and dream wisdom. Its shadow is confusion, deception, and fear projected onto the world.",
reflections:["What fear is distorting your perception?","What truth hides behind the illusion?","Where does imagination serve ‚Äî and where does it deceive?"]},

{id:19,numeral:"XIX",name:"THE SUN",symbol:"‚òÄ",archetype:"The Radiant Self",
light16:"Light without hiding.\nThe self shines, unafraid.\nJoy. Warmth. Presence.\nAuthentic expression\nthat needs no permission.",
shadow16:"A smile that hides the ache.\nBrightness denying the dark.\nIs this joy ‚Äî or performance?\nForced positivity\nthat burns the one who carries it.",
expanded:"The Sun is the archetype of radiant, authentic self-expression ‚Äî the joy that comes from being fully and unapologetically yourself. This is the inner child restored: vitality, playfulness, warmth, and the simple pleasure of being alive. In Jungian terms, The Sun represents the ego in harmonious relationship with the Self ‚Äî consciousness illuminated by its own deeper source. The shadow of The Sun is forced positivity: the exhausting performance of happiness that denies the legitimate darkness within, leading to burnout and inauthenticity.",
reflections:["Where do you feel most yourself?","Is your brightness authentic ‚Äî or performative?","What does genuine joy feel like in your body?"]},

{id:20,numeral:"XX",name:"JUDGEMENT",symbol:"üîî",archetype:"The Great Awakening",
light16:"A call sounds from within.\nRise from what was.\nAll parts of you ‚Äî gather.\nThis is not judgment of fault\nbut the reckoning of wholeness.",
shadow16:"The call goes unanswered.\nRefusal to rise from old ashes.\nSelf-condemnation\nreplaces self-reckoning.\nThe trumpet sounds,\nbut you cover your ears.",
expanded:"Judgement is the archetype of awakening ‚Äî the moment when all scattered parts of the self are called to rise and integrate. This is not judgment in the punitive sense but a profound self-reckoning: the willingness to face everything you have been and gather it into a coherent whole. In Jungian psychology, Judgement represents the individuation process nearing completion ‚Äî the call of the Self to the ego, demanding that nothing be left behind or disowned. The shadow is the refusal to answer this call: self-condemnation replacing self-understanding, or fear of the past preventing resurrection.",
reflections:["What is calling you to rise ‚Äî and what holds you down?","What part of your past needs integration, not rejection?","What would it mean to answer your own call?"]},

{id:21,numeral:"XXI",name:"THE WORLD",symbol:"‚óØ",archetype:"The Completed Cycle",
light16:"The circle closes.\nWholeness ‚Äî not perfection.\nDance at the center.\nCompletion is not a destination\nbut a way of being present.",
shadow16:"Arrival becomes prison.\nThe completed story\nfears its own sequel.\nClinging to wholeness\nrather than releasing into\nwhat comes next.",
expanded:"The World is the archetype of completion ‚Äî the dance at the center of one's own mandala. This is not a static ending but a dynamic wholeness: the integration of all previous archetypes into a living, breathing totality. In Jungian terms, The World represents the Self fully realized ‚Äî not perfect, but complete in its acceptance of all its parts. The paradox of The World is that true completion always contains the seed of the next beginning. Its shadow is the refusal to let go of arrival: clinging to a sense of wholeness rather than allowing the cycle to begin again.",
reflections:["What cycle is completing in your life?","Can you celebrate arrival without clinging to it?","What new beginning hides within this ending?"]}
];

// ‚ïê‚ïê‚ïê SYNTHESIS RULES ‚Äî expanded, no doubled words ‚ïê‚ïê‚ïê
var SYNTHESIS_RULES=[
{pair:[13,14],theme:"Transformation seeks Integration.",narrative:"What has ended asks to be blended,\nnot mourned. Loss is not the final word ‚Äî\nit is the raw material.\nAlchemy follows dissolution.\nPatience now is sacred work."},
{pair:[16,17],theme:"Collapse opens to Renewal.",narrative:"A tower falls and stars appear.\nDestruction was not punishment ‚Äî\nit was the clearing of false ground.\nGentle light fills the space\nwhere illusion once stood."},
{pair:[13,17],theme:"Ending feeds Renewal.",narrative:"From the compost of the old self,\ngentle light returns. Loss becomes\nthe soil of hope. What died\nwas not wasted ‚Äî it was composted\ninto something the future can grow from."},
{pair:[15,6],theme:"Attachment versus Authentic Choice.",narrative:"Chains whisper comfort while\nthe heart demands truth.\nWhat do you choose ‚Äî safety or love?\nBondage feels familiar.\nFreedom feels like falling.\nBut only one path is real."},
{pair:[1,2],theme:"Conscious meets Unconscious.",narrative:"A hand that shapes the world\nand a depth that knows without words.\nAction and intuition seek balance.\nNeither alone is complete ‚Äî\nmastery requires both\nthe visible and invisible."},
{pair:[4,3],theme:"Structure meets Flow.",narrative:"A throne and a garden.\nOrder and abundance seek\na living balance between them.\nToo much structure kills growth.\nToo much wildness loses form.\nThe art is holding both."},
{pair:[9,19],theme:"Solitude meets Radiance.",narrative:"A lamp in the cave\nand sunlight in the open field.\nBoth are light ‚Äî different medicines\nfor different wounds.\nOne heals through stillness,\nthe other through expression."},
{pair:[0,21],theme:"Beginning meets Completion.",narrative:"A leap and a dance ‚Äî\npoints on the same circle.\nEvery ending seeds a start.\nThe Wanderer and the Dancer\nrecognize each other\nacross the full arc of becoming."},
{pair:[7,12],theme:"Will meets Surrender.",narrative:"Charge forward ‚Äî or let go?\nWarrior and suspended one\nteach opposing truths.\nSometimes power means advancing.\nSometimes it means\nstopping the fight entirely."},
{pair:[8,15],theme:"Gentle Power meets Shadow Bondage.",narrative:"A lion can be calmed.\nChains can be removed.\nBoth require the courage to look\ndirectly at what frightens you.\nCompassion and awareness\nare twin keys to liberation."},
{pair:[11,20],theme:"Accountability meets Awakening.",narrative:"Scales measure what is real.\nA trumpet calls what is possible.\nAccountability becomes liberation\nwhen honest seeing\nreplaces self-punishment\nand reckoning leads to rising."},
{pair:[18,19],theme:"Illusion meets Clarity.",narrative:"Moonlight and sunlight\nfall on one landscape.\nWhat you feared in darkness\nreveals itself in dawn\nas smaller and simpler\nthan the shadow it cast."},
{pair:[16,13],theme:"Destruction meets Transformation.",narrative:"Two forces of ending converge.\nSomething profound is being dismantled ‚Äî\nnot by accident but by necessity.\nTrust the process.\nWhat cannot survive truth\nwas never truly alive."},
{pair:[5,0],theme:"Tradition meets Wanderer.",narrative:"An old path and a pathless field.\nWhat was taught and what must\nbe discovered through experience.\nHonor the map ‚Äî then step\nbeyond its edges\ninto your own territory."},
{pair:[10,21],theme:"Turning meets Wholeness.",narrative:"Within the spinning ‚Äî\na still center.\nA cycle approaches completion.\nNot all movement is progress,\nbut this turning\nhas direction and meaning."},
{pair:[3,13],theme:"Creation meets Dissolution.",narrative:"Mother and transformer.\nLife that gives and life that takes.\nBoth are necessary.\nWithout ending, creation stagnates.\nWithout creation,\nending is only loss."},
{pair:[6,9],theme:"Connection meets Solitude.",narrative:"To love truly,\none must first be whole alone.\nWithdrawal serves union\nwhen solitude deepens\nthe self that returns\nto relationship."},
{pair:[15,16],theme:"Bondage before Breaking.",narrative:"Chains tighten before\nlightning strikes them free.\nLiberation comes not\nwhen you plan your escape\nbut when you can no longer\nbear the cage."},
{pair:[2,18],theme:"Depth meets Illusion.",narrative:"Priestess and moon share\nthe language of the unconscious.\nDeep knowing navigates\nwhat surface seeing cannot.\nTrust the sense beneath\nthe confusion of appearances."},
{pair:[1,15],theme:"Will meets Compulsion.",narrative:"Mastery and addiction\nshare one root: desire.\nOne is conscious, directed,\naligned with purpose.\nThe other runs in circles,\nfeeding what it cannot fill."}
];

var INTENSIFIERS={13:[16,15,10],16:[13,15,20],0:[21,10],8:[2,11],19:[17,0],15:[18,1]};

var drawnCards=[];
var flippedCount=0;

function shuffleDeck(){
  var d=[];for(var i=0;i<22;i++)d.push(i);
  for(var i=d.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=d[i];d[i]=d[j];d[j]=t;}
  return d;
}

function populateCardBacks(){
  for(var i=0;i<3;i++){
    var b=document.getElementById('card-back-'+i);
    b.classList.remove('has-image');
    b.innerHTML='<img class="card-back-img" src="'+CARD_BACK_IMG+'" onload="this.parentElement.classList.add(\'has-image\')" onerror="this.style.display=\'none\'"><div class="card-back-fallback"><div class="card-back-diamond"></div><div class="card-back-diamond"></div><div class="card-back-diamond"></div></div>';
  }
}

function beginReading(){
  var deck=shuffleDeck();
  drawnCards=[deck[0],deck[1],deck[2]];
  flippedCount=0;
  populateCardBacks();
  for(var i=0;i<3;i++){
    var c=ARCANA[drawnCards[i]],f=document.getElementById('card-front-'+i),src=cardImagePath(c.id);
    f.classList.remove('has-image');
    f.innerHTML='<img class="card-front-img" src="'+src+'" onload="this.parentElement.classList.add(\'has-image\')" onerror="this.style.display=\'none\'"><div class="card-front-fallback"><span class="fb-numeral">'+c.numeral+'</span><span class="fb-symbol">'+c.symbol+'</span><span class="fb-name">'+c.name+'</span></div><div class="card-front-label">'+c.name+'</div>';
  }
  document.querySelectorAll('.card-slot').forEach(function(s){s.classList.remove('flipped')});
  document.getElementById('read-btn').classList.remove('visible');
  document.getElementById('spread-instruction').classList.remove('hidden');
  document.getElementById('spread-instruction').textContent='TAP A CARD TO REVEAL';
  switchScreen('spread-screen');
}

function flipCard(i){
  var s=document.querySelectorAll('.card-slot')[i];
  if(s.classList.contains('flipped'))return;
  s.classList.add('flipped');flippedCount++;
  if(flippedCount<3){var r=3-flippedCount;document.getElementById('spread-instruction').textContent=r===1?'ONE CARD REMAINS':r+' CARDS REMAIN';}
  else{document.getElementById('spread-instruction').classList.add('hidden');setTimeout(function(){document.getElementById('read-btn').classList.add('visible')},400);}
}

function switchScreen(id){document.querySelectorAll('.screen').forEach(function(s){s.classList.remove('active')});document.getElementById(id).classList.add('active');}

function findSynthesisRule(a,b){return SYNTHESIS_RULES.find(function(r){return(r.pair[0]===a&&r.pair[1]===b)||(r.pair[0]===b&&r.pair[1]===a)});}
function isIntensified(a,b){return(INTENSIFIERS[a]&&INTENSIFIERS[a].indexOf(b)!==-1)||(INTENSIFIERS[b]&&INTENSIFIERS[b].indexOf(a)!==-1);}

function generateSynthesis(cards){
  var c=cards.map(function(id){return ARCANA[id]});
  var pN=null,pT=null,pairs=[[0,1],[1,2],[0,2]];
  for(var p=0;p<pairs.length;p++){var r=findSynthesisRule(cards[pairs[p][0]],cards[pairs[p][1]]);if(r){pN=r.narrative;pT=r.theme;break;}}
  var intense=false;for(var q=0;q<pairs.length;q++){if(isIntensified(cards[pairs[q][0]],cards[pairs[q][1]])){intense=true;break;}}
  var L=[];
  if(pT){L.push(pT);L.push('');L.push(pN);}
  else{
    L.push(c[0].name+' moves through you.');
    L.push(c[1].name+' creates tension.');
    L.push(c[2].name+' holds the key.');
    L.push('');
    L.push(c[0].archetype+' energy');
    L.push('encounters '+c[1].archetype.charAt(0).toLowerCase()+c[1].archetype.slice(1)+'.');
    L.push('From this tension,');
    L.push(c[2].archetype+' emerges ‚Äî');
    L.push('not as resolution, but as invitation.');
  }
  if(intense){L.push('');L.push('‚ö° These forces amplify each other.');L.push('This pattern runs deep.\nPay close attention here.');}
  return{lines:L.join('\n'),question:c[2].reflections[Math.floor(Math.random()*c[2].reflections.length)]};
}

function showReading(){
  var ct=document.getElementById('reading-container');ct.innerHTML='';
  var pos=[{label:'I ‚Äî ACTIVE ARCHETYPE'},{label:'II ‚Äî SHADOW / CHALLENGE'},{label:'III ‚Äî EMERGING POTENTIAL'}];
  for(var i=0;i<3;i++){
    var card=ARCANA[drawnCards[i]],p=pos[i],ref=card.reflections[Math.floor(Math.random()*card.reflections.length)];
    var isShadow=(i===1); // Only card 2 gets shadow interpretation
    var bx=document.createElement('div');bx.className='text-box card-reading';bx.style.animationDelay=(0.2+i*0.5)+'s';
    var thumbHtml='<img class="tb-thumb" src="'+cardImagePath(card.id)+'" onerror="this.outerHTML=\'<div class=tb-thumb-fallback>'+card.symbol+'</div>\'">';
    var bodyText='<div class="tb-light">'+card.light16+'</div>';
    if(isShadow){bodyText='<div class="tb-shadow">Shadow: '+card.shadow16+'</div>';}
    bx.innerHTML='<div class="tb-header">'+thumbHtml+'<div class="tb-header-text"><div class="tb-position">'+p.label+'</div><div class="tb-card-name">'+card.name+'</div><div class="tb-numeral">'+card.numeral+' ‚Äî '+card.archetype+'</div></div></div><div class="tb-divider"></div>'+bodyText+'<div class="tb-reflection">'+ref+'</div>';
    ct.appendChild(bx);
  }
  var synth=generateSynthesis(drawnCards);
  var sb=document.createElement('div');sb.className='text-box synthesis-box';sb.style.animationDelay='1.8s';
  sb.innerHTML='<div class="synth-title">‚ú¶ SYNTHESIS ‚ú¶</div><div class="synth-text">'+synth.lines.replace(/\n/g,'<br>')+'</div><div class="synth-question">'+synth.question+'</div>';
  ct.appendChild(sb);
  var btn=document.createElement('button');btn.className='again-btn';btn.textContent='‚Ü∫  DRAW AGAIN';btn.onclick=beginReading;ct.appendChild(btn);
  switchScreen('reading-screen');document.getElementById('reading-screen').scrollTop=0;
}

// ‚ïê‚ïê‚ïê GALLERY ‚ïê‚ïê‚ïê
function showGallery(){
  var ct=document.getElementById('gallery-container');
  ct.innerHTML='<div class="gallery-header"><h2>THE 22 MAJOR ARCANA</h2><p>Tap any card to explore its archetype</p></div><button class="gallery-back-btn" onclick="switchScreen(\'title-screen\')">‚Üê BACK</button><div class="gallery-grid" id="gallery-grid"></div>';
  var grid=document.getElementById('gallery-grid');
  for(var i=0;i<22;i++){
    (function(idx){
      var c=ARCANA[idx],el=document.createElement('div');el.className='gallery-card';
      el.innerHTML='<img src="'+cardImagePath(c.id)+'" onload="this.parentElement.classList.add(\'has-image\')" onerror="this.style.display=\'none\'"><div class="gallery-card-fallback">'+c.symbol+'<br><span style="font-size:6px">'+c.name+'</span></div><div class="gallery-card-name">'+c.name+'</div>';
      el.onclick=function(){showDetail(idx)};
      grid.appendChild(el);
    })(i);
  }
  switchScreen('gallery-screen');document.getElementById('gallery-screen').scrollTop=0;
}

function showDetail(idx){
  var c=ARCANA[idx],ct=document.getElementById('detail-container');
  var reflectHtml='';for(var r=0;r<c.reflections.length;r++){reflectHtml+='‚Ä¢ '+c.reflections[r]+'<br>';}
  ct.innerHTML='<button class="detail-back-btn" onclick="showGallery()">‚Üê ALL ARCANA</button>'+
    '<img class="detail-card-img" src="'+cardImagePath(c.id)+'" onerror="this.outerHTML=\'<div class=detail-card-fallback>'+c.symbol+'</div>\'">'+
    '<div class="detail-name">'+c.name+'</div>'+
    '<div class="detail-numeral">'+c.numeral+'</div>'+
    '<div class="detail-archetype">'+c.archetype+'</div>'+
    '<div class="detail-section"><div class="detail-section-title">‚ú¶ LIGHT EXPRESSION</div><div class="detail-section-text">'+c.light16+'</div></div>'+
    '<div class="detail-section"><div class="detail-section-title">‚óâ SHADOW EXPRESSION</div><div class="detail-section-text shadow-text">'+c.shadow16+'</div></div>'+
    '<div class="detail-section"><div class="detail-section-title">‚óØ ARCHETYPAL MEANING</div><div class="detail-section-text">'+c.expanded+'</div></div>'+
    '<div class="detail-section"><div class="detail-section-title">‚úß REFLECTIVE PROMPTS</div><div class="detail-section-text reflect-text">'+reflectHtml+'</div></div>';
  switchScreen('detail-screen');document.getElementById('detail-screen').scrollTop=0;
}
</script>
</body>
</html>
